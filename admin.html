<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel Admin - Farmacia Ortopedia Lili</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {margin:0; font-family:system-ui,sans-serif; background:#f0f4f8; color:#1f2937;}
header {background:#2563eb; padding:1.2rem; text-align:center; font-size:2rem; font-weight:bold; color:white;}
.container {display:flex; min-height:30px;}
aside {background:#2563eb; width:230px; padding:12px; color:white;}
aside h2 {color:#facc15; font-size:1.2rem; padding: 4px 0; margin-bottom:0.8rem;}
.nav-btn {display:block; width:100%; margin:0.3rem 0; padding:0.7rem 1rem;
  border:none; background:none; color:white; text-align:left;
  border-radius:8px; cursor:pointer; transition:0.2s;}
.nav-btn.active, .nav-btn:hover {background:#5f687a; color:white;}
main {flex:1; padding:0; background:#e5e7eb;}
iframe {width:100%; height:calc(100vh - 70px); border:none; background:white;}
.logout {position:fixed;top:16px;right:24px; background:#dc2626; padding:8px 16px;
  border-radius:8px;font-weight:bold; cursor:pointer; color:white;}
.logout:hover {background:#b91c1c;}
.admin-section {display:none; padding:2em; border-radius:16px; margin:2em; background:white; color:#111;}
.admin-section.active {display:block;}
table {width:100%; border-collapse:collapse; margin-top:1em; background:#fff;}
th,td {border:1px solid #ddd; padding:7px 6px; text-align:left;}
th {background:#2563eb; color:white;}
tr:nth-child(even) {background:#f3f4f6;}
input, select, button { padding:7px; border-radius:6px; border:1px solid #ccc;}
input, select { margin:0 0.4rem 0.7rem 0; background:#f9fafb; color:#111;}
button { background:#2563eb; color:white; cursor:pointer;}
.btn-del {background:#dc2626;}
.btn-edit {background:#f59e0b;}
.btn-save {background:#16a34a;}
.btn-small { font-size:0.95em; padding:3px 9px; margin-left:4px;}
</style>
</head>
<body>
<header>👑  ADMINISTRACIÓN  👑</header>
<button class="logout" onclick="cerrarSesion()">Cerrar Sesión</button>
<div class="container">
  <aside>
    <hr>
    <h2>🏪 Ventas 🏪 </h2>
    <button class="nav-btn" onclick="showPage('farma1.html',this)">💳 Ventas - FarmaciaLili 1.0 💳</button>
    <button class="nav-btn" onclick="showPage('farma2.html',this)">💳 Ventas - FarmaciaLili 2.0 💳</button>
    <button class="nav-btn" onclick="showPage('farma3.html',this)">💳 Ventas - FarmaciaLili 3.0 💳</button>    
    <button class="nav-btn" onclick="showPage('ortopedia.html',this)">🩺 Ventas - OrtopediaLili 🩺 </button>
    <hr>
    <h2>👤 Usuarios</h2>
    <button class="nav-btn" onclick="showSection('usuarios',this)">👤 Gestión de Usuarios</button>
    <button class="nav-btn" onclick="showSection('actividad',this)">📋 Actividad Usuarios</button>
  </aside>
  <main>
    <iframe id="panelFrame" src=""></iframe>

    <!-- Gestión de Usuarios -->
    <div id="usuarios" class="admin-section">
      <h2>👤 Gestión de Usuarios 👤</h2>
      <table id="tabla-users">
        <thead>
          <tr>
            <th>Usuario</th>
            <th>Área</th>
            <th>Contraseña</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <h3> ➕ Agregar Usuario 👤</h3>
      <input id="user-nombre" placeholder="Usuario">
      <select id="user-area">
        <option value="">Selecciona área</option>
        <option value="Farmacia1">FarmaciaLili 1.0 </option>
        <option value="Farmacia2">FarmaciaLili 2.0 </option>
        <option value="Farmacia3">FarmaciaLili 3.0 </option>
        <option value="Ortopedia">OrtopediaLili</option>
        <option value="Admin">Admin</option>
      </select>
      <input id="user-pass" type="password" placeholder="Contraseña">
      <button class="btn-save" onclick="agregarUsuario()">Agregar</button>
    </div>

    <!-- Actividad Usuarios -->
    <div id="actividad" class="admin-section">
      <h2>📋 Registro de Actividad Usuarios</h2>
      <button onclick="resetActividad()" style="margin:10px;padding:6px 12px;background:#dc2626;color:#fff;border:none;border-radius:6px;cursor:pointer">🗑 Eliminar Actividad</button>
      <table id="tabla-actividad">
        <thead>
          <tr>
            <th>Usuario</th>
            <th>Inicio</th>
            <th>Cierre</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </main>
</div>

<script>
// Función página según área
function paginaPorArea(area){
  switch(area){
    case "Farmacia1": return "farma1.html";
    case "Farmacia2": return "farma2.html";
    case "Farmacia3": return "farma3.html";
    case "Ortopedia": return "ortopedia.html";
    case "Admin": return "admin.html";
    default: return "index.html";
  }
}

// Usuarios
let usuarios = JSON.parse(localStorage.getItem("usuarios")||"[]");
if(usuarios.length===0){
  usuarios=[{usuario:"AdminFarmalili", pass:"Mariposa", area:"Admin", pagina:"admin.html"}];
  localStorage.setItem("usuarios",JSON.stringify(usuarios));
}

// Actividad
let actividad = JSON.parse(localStorage.getItem("actividad")||"[]");

function actualizarTablaActividad(){
  let tbody=document.querySelector("#tabla-actividad tbody");
  tbody.innerHTML="";
  actividad.forEach(a=>{
    tbody.innerHTML+=`<tr><td>${a.usuario}</td><td>${a.inicio}</td><td>${a.cierre||"-"}</td></tr>`;
  });
}
actualizarTablaActividad();

// Botón reset actividad
function resetActividad(){
  if(confirm("¿Seguro que deseas borrar toda la actividad?")){
    actividad=[];
    localStorage.setItem("actividad",JSON.stringify(actividad));
    actualizarTablaActividad();
  }
}

// Navegación
function showPage(page,btn){
  document.getElementById('panelFrame').style.display='block';
  document.querySelectorAll('.admin-section').forEach(s=>s.classList.remove('active'));
  document.getElementById('panelFrame').src=page+"?viewer=admin";
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
}
function showSection(id,btn){
  document.getElementById('panelFrame').style.display='none';
  document.querySelectorAll('.admin-section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
}

// Cerrar sesión
function cerrarSesion(){ 
  let usuarioActivo = localStorage.getItem("usuarioActivo");
  if(usuarioActivo){
    actividad = JSON.parse(localStorage.getItem("actividad")||"[]");
    for(let i=actividad.length-1;i>=0;i--){
      if(actividad[i].usuario === usuarioActivo && !actividad[i].cierre){
        actividad[i].cierre = new Date().toLocaleString();
        break;
      }
    }
    localStorage.setItem("actividad", JSON.stringify(actividad));
  }
  actualizarTablaActividad();
  localStorage.removeItem("usuarioActivo"); 
  window.location.href="index.html"; 
}

// Usuarios
function renderUsers(){
  let tbody=document.querySelector("#tabla-users tbody");
  tbody.innerHTML="";
  usuarios.forEach((u,i)=>{
    let esAdmin = u.usuario==="AdminFarmalili";
    tbody.innerHTML+=`<tr>
      <td>${u.usuario}</td>
      <td>${u.area}</td>
      <td>${u.pass}</td>
      <td>
        ${esAdmin?'<span style="color:#888">Bloqueado</span>':
        `<button class="btn-edit btn-small" onclick="editarUsuario(${i})">Editar</button>
         <button class="btn-del btn-small" onclick="borrarUsuario(${i})">Borrar</button>`}
      </td>
    </tr>`;
  });
}
function agregarUsuario(){
  let nombre=document.getElementById("user-nombre").value.trim();
  let area=document.getElementById("user-area").value;
  let pass=document.getElementById("user-pass").value.trim();
  if(!nombre||!area||!pass) return alert("Completa todos los campos");
  if(usuarios.find(u=>u.usuario===nombre)) return alert("Usuario ya existe");
  let pagina=paginaPorArea(area);
  usuarios.push({usuario:nombre, area, pass, pagina});
  localStorage.setItem("usuarios",JSON.stringify(usuarios));
  renderUsers();
}
function editarUsuario(i){
  let u=usuarios[i];
  let nuevo=prompt("Editar usuario (usuario,area,contraseña)",`${u.usuario},${u.area},${u.pass}`);
  if(!nuevo) return;
  let [usuario,area,pass]=nuevo.split(",");
  if(!usuario||!area||!pass) return alert("Todos los campos son obligatorios");
  usuarios[i]={usuario, area, pass, pagina:paginaPorArea(area)};
  localStorage.setItem("usuarios",JSON.stringify(usuarios));
  renderUsers();
}
function borrarUsuario(i){
  if(usuarios[i].usuario==="AdminFarmalili") return alert("No puedes borrar al administrador");
  usuarios.splice(i,1);
  localStorage.setItem("usuarios",JSON.stringify(usuarios));
  renderUsers();
}
renderUsers();
</script>
</body>
</html>


